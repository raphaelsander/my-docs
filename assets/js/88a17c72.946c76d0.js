"use strict";(globalThis.webpackChunkmy_docs=globalThis.webpackChunkmy_docs||[]).push([[4144],{2337(e,n,o){o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>m,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"pentest/subdomain-takeover","title":"subdomain-takeover","description":"Subdomain Takeover \xe9 uma vulnerabilidade em que um atacante consegue assumir","source":"@site/docs/pentest/subdomain_takeover.mdx","sourceDirName":"pentest","slug":"/pentest/subdomain-takeover","permalink":"/my-docs/docs/pentest/subdomain-takeover","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"subdomain-takeover","title":"subdomain-takeover"},"sidebar":"tutorialSidebar","previous":{"title":"sqli","permalink":"/my-docs/docs/pentest/sqli"},"next":{"title":"subfinder","permalink":"/my-docs/docs/pentest/subfinder"}}');var s=o(4848),r=o(8453);const a={id:"subdomain-takeover",title:"subdomain-takeover"},l=void 0,d={},c=[{value:"Como Funciona",id:"como-funciona",level:2},{value:"Exemplo Pr\xe1tico",id:"exemplo-pr\xe1tico",level:2},{value:"Onde Isso Acontece com Frequ\xeancia",id:"onde-isso-acontece-com-frequ\xeancia",level:2},{value:"Impactos",id:"impactos",level:2},{value:"Por que Isso Acontece?",id:"por-que-isso-acontece",level:2},{value:"Como Prevenir",id:"como-prevenir",level:2},{value:"1. Invent\xe1rio cont\xednuo de subdom\xednios",id:"1-invent\xe1rio-cont\xednuo-de-subdom\xednios",level:3},{value:"2. Monitorar registros CNAME e A",id:"2-monitorar-registros-cname-e-a",level:3},{value:"3. Remover DNS ao desativar servi\xe7os",id:"3-remover-dns-ao-desativar-servi\xe7os",level:3},{value:"4. Monitoramento autom\xe1tico",id:"4-monitoramento-autom\xe1tico",level:3},{value:"5. Pol\xedtica de dom\xednio interno",id:"5-pol\xedtica-de-dom\xednio-interno",level:3},{value:"Como Identificar",id:"como-identificar",level:2},{value:"Rela\xe7\xe3o com Outras Falhas",id:"rela\xe7\xe3o-com-outras-falhas",level:2}];function t(e){const n={code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Subdomain Takeover"})," \xe9 uma vulnerabilidade em que um atacante consegue assumir\no controle de um subdom\xednio leg\xedtimo de uma organiza\xe7\xe3o porque ele est\xe1\napontando (via DNS) para um recurso externo que n\xe3o est\xe1 mais configurado ou n\xe3o\nexiste."]}),"\n",(0,s.jsx)(n.p,{children:"\xc9 um problema comum em ambientes que utilizam muitos servi\xe7os SaaS, cloud ou\nintegra\xe7\xf5es externas."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"como-funciona",children:"Como Funciona"}),"\n",(0,s.jsx)(n.p,{children:"Normalmente envolve:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Um subdom\xednio configurado no DNS, por exemplo:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-none",children:"blog.empresa.com \u2192 CNAME \u2192 empresa-blog.saas-provider.com\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["O recurso no provedor externo (ex: SaaS, cloud storage, app hospedada) \xe9\nremovido, mas o ",(0,s.jsx)(n.strong,{children:"registro DNS continua existindo"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"O atacante:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Cria uma conta no mesmo provedor"}),"\n",(0,s.jsx)(n.li,{children:"Registra o mesmo identificador do recurso abandonado"}),"\n",(0,s.jsx)(n.li,{children:"Passa a controlar o conte\xfado servido por aquele subdom\xednio"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Resultado: o dom\xednio oficial passa a apontar para infraestrutura controlada pelo\natacante."}),"\n",(0,s.jsx)(n.h2,{id:"exemplo-pr\xe1tico",children:"Exemplo Pr\xe1tico"}),"\n",(0,s.jsx)(n.p,{children:"Imagine que a empresa usava:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"app.empresa.com"})," apontando via CNAME para um app no Heroku"]}),"\n",(0,s.jsx)(n.li,{children:"A aplica\xe7\xe3o foi deletada no Heroku"}),"\n",(0,s.jsxs)(n.li,{children:["O DNS continua apontando para ",(0,s.jsx)(n.code,{children:"app-heroku.herokuapp.com"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Se o nome estiver dispon\xedvel novamente, um atacante pode:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Criar um app com o mesmo nome no Heroku"}),"\n",(0,s.jsx)(n.li,{children:"Associar o dom\xednio customizado"}),"\n",(0,s.jsxs)(n.li,{children:["Assumir ",(0,s.jsx)(n.code,{children:"app.empresa.com"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"onde-isso-acontece-com-frequ\xeancia",children:"Onde Isso Acontece com Frequ\xeancia"}),"\n",(0,s.jsx)(n.p,{children:"Servi\xe7os como:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Amazon Web Services (S3, Elastic Beanstalk)"}),"\n",(0,s.jsx)(n.li,{children:"Microsoft Azure"}),"\n",(0,s.jsx)(n.li,{children:"GitHub (GitHub Pages)"}),"\n",(0,s.jsx)(n.li,{children:"Shopify"}),"\n",(0,s.jsx)(n.li,{children:"Vercel"}),"\n",(0,s.jsx)(n.li,{children:"Netlify"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Principalmente quando:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Ambientes de teste s\xe3o deletados"}),"\n",(0,s.jsx)(n.li,{children:"Projetos tempor\xe1rios s\xe3o encerrados"}),"\n",(0,s.jsx)(n.li,{children:"Times esquecem de remover registros DNS antigos"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"impactos",children:"Impactos"}),"\n",(0,s.jsx)(n.p,{children:"Um subdomain takeover pode permitir:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Phishing com dom\xednio leg\xedtimo"}),"\n",(0,s.jsx)(n.li,{children:"Roubo de credenciais"}),"\n",(0,s.jsx)(n.li,{children:"Distribui\xe7\xe3o de malware"}),"\n",(0,s.jsx)(n.li,{children:"Bypass de pol\xedticas de seguran\xe7a baseadas em dom\xednio"}),"\n",(0,s.jsx)(n.li,{children:"Comprometimento de confian\xe7a da marca"}),"\n",(0,s.jsxs)(n.li,{children:["Poss\xedvel explora\xe7\xe3o de cookies com escopo ",(0,s.jsx)(n.code,{children:".empresa.com"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"por-que-isso-acontece",children:"Por que Isso Acontece?"}),"\n",(0,s.jsx)(n.p,{children:"Porque o DNS \xe9 independente do servi\xe7o final."}),"\n",(0,s.jsx)(n.p,{children:"O DNS:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Continua apontando para um destino v\xe1lido"}),"\n",(0,s.jsx)(n.li,{children:"Mesmo que o recurso no provedor n\xe3o exista mais"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"O provedor:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Permite que outro usu\xe1rio registre aquele recurso novamente"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"como-prevenir",children:"Como Prevenir"}),"\n",(0,s.jsx)(n.h3,{id:"1-invent\xe1rio-cont\xednuo-de-subdom\xednios",children:"1. Invent\xe1rio cont\xednuo de subdom\xednios"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Automatizar varreduras"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Usar ferramentas como:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Subfinder"}),"\n",(0,s.jsx)(n.li,{children:"Amass"}),"\n",(0,s.jsx)(n.li,{children:"Assetfinder"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-monitorar-registros-cname-e-a",children:"2. Monitorar registros CNAME e A"}),"\n",(0,s.jsx)(n.p,{children:"Especial aten\xe7\xe3o para:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"CNAME apontando para servi\xe7os SaaS"}),"\n",(0,s.jsx)(n.li,{children:"Subdom\xednios de ambientes tempor\xe1rios"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-remover-dns-ao-desativar-servi\xe7os",children:"3. Remover DNS ao desativar servi\xe7os"}),"\n",(0,s.jsx)(n.p,{children:"Processo obrigat\xf3rio de:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:'"Delete recurso"'}),"\n",(0,s.jsx)(n.li,{children:'"Delete DNS"'}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"4-monitoramento-autom\xe1tico",children:"4. Monitoramento autom\xe1tico"}),"\n",(0,s.jsx)(n.p,{children:"Ferramentas que detectam dom\xednios \u201cdangling\u201d:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Nuclei (templates de takeover)"}),"\n",(0,s.jsx)(n.li,{children:"Subjack"}),"\n",(0,s.jsx)(n.li,{children:"Tko-subs"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"5-pol\xedtica-de-dom\xednio-interno",children:"5. Pol\xedtica de dom\xednio interno"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Controle centralizado de DNS"}),"\n",(0,s.jsx)(n.li,{children:"Proibi\xe7\xe3o de cria\xe7\xe3o ad-hoc sem registro formal"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"como-identificar",children:"Como Identificar"}),"\n",(0,s.jsx)(n.p,{children:"Indicadores comuns:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Resposta HTTP:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"No such app"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"There isn\u2019t a GitHub Pages site here"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"The specified bucket does not exist"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"CNAME apontando para servi\xe7o SaaS"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"host -t cname <hostname>\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"NXDOMAIN parcial do recurso final"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"rela\xe7\xe3o-com-outras-falhas",children:"Rela\xe7\xe3o com Outras Falhas"}),"\n",(0,s.jsx)(n.p,{children:"Subdomain takeover \xe9 frequentemente explorado em conjunto com:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Misconfigura\xe7\xe3o de DNS"}),"\n",(0,s.jsx)(n.li,{children:"Falhas de governan\xe7a em cloud"}),"\n",(0,s.jsx)(n.li,{children:"Shadow IT"}),"\n",(0,s.jsx)(n.li,{children:"Falta de gest\xe3o de ativos digitais"}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},8453(e,n,o){o.d(n,{R:()=>a,x:()=>l});var i=o(6540);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);