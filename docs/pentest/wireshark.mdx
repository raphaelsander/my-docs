---
id: wireshark
title: wireshark
---

![Wireshark Logo](https://www.wireshark.org/assets/img/wireshark-logo.png)

Wireshark é um software de análise de rede que permite capturar e examinar o
tráfego de dados em uma rede de computadores em tempo real.

[https://www.wireshark.org/](https://www.wireshark.org/)

---

## Filtros de Exibição

Os filtros de exibição são aqueles que irão filtrar os pacotes após serem
interceptados, você pode conferir alguns exemplos básicos diretamente na
documentação do Wireshark:

[https://wiki.wireshark.org/DisplayFilters](https://wiki.wireshark.org/DisplayFilters)

## Reconhecendo FTP em Porta não Padrão

Quando o FTP está rodando em uma porta diferente da padrão, porta 21, não é
possível identificar os pacotes FTP com os filtros ``ftp`` ou ``ftp-data``, para
isso teremos que procurar pelas mensagens padrões da comunicação do protocolo
FTP, podendo ser de tentativa de login, transferência de arquivos, etc.

Checando tentativas de login no FTP:

```wireshark
tcp contains "USER" || tcp contains "PASS"
```

Checando download de arquivo:

```wireshark
tcp contains "RETR" || tcp contains "PASV" || tcp contains "PORT"
```

Outros filtros FTP que podem ser úteis:

```wireshark
tcp contains "STOR"
tcp contains "LIST"
tcp contains "CWD"
tcp contains "QUIT"
tcp contains "MKD"
tcp contains "RMD"
tcp contains "DELE"
tcp contains "RNFR"
tcp contains "RNTO"
tcp contains "ABOR"
tcp contains "TYPE"
tcp contains "MODE"
tcp contains "STRU"
tcp contains "NOOP"
tcp contains "SYST"
```

| Comando | Descrição                                                                                                                                  |
|---------|--------------------------------------------------------------------------------------------------------------------------------------------|
| USER    | Envia o nome de usuário ao servidor para iniciar uma sessão de login.                                                                      |
| PASS    | Envia a senha do usuário ao servidor para autenticação.                                                                                    |
| RETR    | Solicita a transferência de um arquivo do servidor para o cliente (download).                                                              |
| PASV    | Instrui o servidor a entrar no modo passivo, retornando um endereço IP e porta para o cliente conectar para transferências de dados.       |
| PORT    | Instrui o cliente a fornecer ao servidor o endereço IP e porta onde o servidor deve se conectar para transferências de dados (modo ativo). |
| STOR    | Solicita a transferência de um arquivo do cliente para o servidor (upload).                                                                |
| LIST    | Solicita uma lista detalhada de arquivos e diretórios no servidor.                                                                         |
| CWD     | Altera o diretório de trabalho atual no servidor.                                                                                          |
| QUIT    | Termina a sessão de login e desconecta o cliente do servidor.                                                                              |
| MKD     | Cria um novo diretório no servidor.                                                                                                        |
| RMD     | Remove um diretório do servidor.                                                                                                           |
| DELE    | Exclui um arquivo do servidor.                                                                                                             |
| RNFR    | Indica o nome de um arquivo ou diretório a ser renomeado. Deve ser seguido pelo comando RNTO.                                              |
| RNTO    | Especifica o novo nome para o arquivo ou diretório indicado pelo comando RNFR.                                                             |
| ABOR    | Aborta uma transferência de dados em andamento.                                                                                            |
| TYPE    | Define o tipo de representação de dados a ser usado para transferências (por exemplo, binário ou ASCII).                                   |
| MODE    | Define o modo de transferência de dados (por exemplo, fluxo, bloco ou comprimido).                                                         |
| STRU    | Define a estrutura de armazenamento de arquivos a ser usada para transferências (por exemplo, arquivo, registro ou página).                |
| NOOP    | Não faz nada, apenas faz o servidor enviar uma resposta para manter a conexão ativa.                                                       |
| SYST    | Solicita informações sobre o sistema operacional do servidor.                                                                              |

Após identificar em qual porta o FTP server está executando podemos indicar para
o Wireshark que efetue o decode como FTP com base naquela porta:

![decode_as_shadow.png](/img/wireshark/decode_as_shadow.png)

![decode_as_ftp_shadow.png](/img/wireshark/decode_as_ftp_shadow.png)

Agora temos a capacidade de filtrar o `ftp` e o `ftp-data` diretamente no campo
de filtro do Wireshark.

![ftp_ftp-data_shadow.png](/img/wireshark/ftp_ftp-data_shadow.png)

## Salvando Arquivos Transferidos no FTP

Para salvar o arquivo que foi transferido no FTP, basta efetuar o filtro por
`ftp-data` e efetuar o "**Follow**" do "**TCP Stream**".

![ftp-data_tcp_stream_shadow.png](/img/wireshark/ftp-data_tcp_stream_shadow.png)

Configure o "**Show data as**" como "**Raw**" e salve o arquivo com nome e
extenção correta.

![raw_save_shadow.png](/img/wireshark/raw_save_shadow.png)

Arquivo PCAP usado como exemplo: [invasao.pcap](/files/wireshark/invasao.pcap)
